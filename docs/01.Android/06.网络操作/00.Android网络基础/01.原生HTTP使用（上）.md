---
title: åŸç”ŸHTTPä½¿ç”¨ï¼ˆä¸Šï¼‰
date: 2021-08-07 18:19:53
permalink: /pages/aa3cc4/
categories:
  - Android
  - ç½‘ç»œæ“ä½œ
  - Androidç½‘ç»œåŸºç¡€
tags:
  - 
---
> æ–‡ç« è½¬è½½è‡ªã€èœé¸Ÿæ•™ç¨‹ã€‘[https://www.runoob.com/w3cnote/android-tutorial-httpurlconnection.html](https://www.runoob.com/w3cnote/android-tutorial-httpurlconnection.html)

## 1. HttpURLConnectionç®€ä»‹

ç­”ï¼šä¸€ç§å¤šç”¨é€”ã€è½»é‡æçš„HTTPå®¢æˆ·ç«¯ï¼Œä½¿ç”¨å®ƒæ¥è¿›è¡ŒHTTPæ“ä½œå¯ä»¥é€‚ç”¨äºå¤§å¤šæ•°çš„åº”ç”¨ç¨‹åºã€‚ è™½ç„¶HttpURLConnectionçš„APIæä¾›çš„æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯åŒæ—¶è¿™ä¹Ÿä½¿å¾—æˆ‘ä»¬å¯ä»¥æ›´åŠ å®¹æ˜“åœ°å»ä½¿ ç”¨å’Œæ‰©å±•å®ƒã€‚ç»§æ‰¿è‡³URLConnectionï¼ŒæŠ½è±¡ç±»ï¼Œæ— æ³•ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚é€šè¿‡è°ƒç”¨**openCollection**() æ–¹æ³•è·å¾—å¯¹è±¡å®ä¾‹ï¼Œé»˜è®¤æ˜¯å¸¦`gzip`å‹ç¼©çš„ï¼›

------

## 2. HttpURLConnectionçš„ä½¿ç”¨æ­¥éª¤

**ä½¿ç”¨HttpURLConnectionçš„æ­¥éª¤å¦‚ä¸‹ï¼š**

(1) åˆ›å»ºä¸€ä¸ªURLå¯¹è±¡ï¼š **URL url = new URL(https://www.baidu.com);**

(2) è°ƒç”¨URLå¯¹è±¡çš„openConnection( )æ¥è·å–HttpURLConnectionå¯¹è±¡å®ä¾‹ï¼š **HttpURLConnection conn = (HttpURLConnection) url.openConnection();**

(3) è®¾ç½®HTTPè¯·æ±‚ä½¿ç”¨çš„æ–¹æ³•:GETæˆ–è€…POSTï¼Œæˆ–è€…å…¶ä»–è¯·æ±‚æ–¹å¼æ¯”å¦‚ï¼šPUT **conn.setRequestMethod("GET");**

(4) è®¾ç½®è¿æ¥è¶…æ—¶ï¼Œè¯»å–è¶…æ—¶çš„æ¯«ç§’æ•°ï¼Œä»¥åŠæœåŠ¡å™¨å¸Œæœ›å¾—åˆ°çš„ä¸€äº›æ¶ˆæ¯å¤´ **conn.setConnectTimeout(6\*1000);** **conn.setReadTimeout(6 \* 1000);**

(5) è°ƒç”¨getInputStream()æ–¹æ³•è·å¾—æœåŠ¡å™¨è¿”å›çš„è¾“å…¥æµï¼Œç„¶åè¾“å…¥æµè¿›è¡Œè¯»å–äº† **InputStream in = conn.getInputStream();**

(6) æœ€åè°ƒç”¨disconnect()æ–¹æ³•å°†HTTPè¿æ¥å…³æ‰ **conn.disconnect();**

é™¤äº†ä¸Šé¢è¿™äº›å¤–,æœ‰æ—¶æˆ‘ä»¬è¿˜å¯èƒ½éœ€è¦å¯¹**å“åº”ç **è¿›è¡Œåˆ¤æ–­,æ¯”å¦‚200: 

```java
if(conn.getResponseCode() != 200)
```

- `setConnectTimeout()`ï¼šæŒ‡çš„æ˜¯ä¸è¯·æ±‚ç½‘å€çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚
- `setReadTimeout()`ï¼šæŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åå¦‚æœæŒ‡å®šæ—¶é—´å†…æœåŠ¡å™¨æ²¡æœ‰è¿”å›æ•°æ®çš„åè¶…æ—¶

<br>

## 3.HttpURLConnectionä½¿ç”¨ç¤ºä¾‹

> è¿™é‡Œæˆ‘ä»¬ä¸»è¦é’ˆå¯¹GETå’ŒPOSTè¯·æ±‚å†™ä¸¤ä¸ªä¸åŒçš„ä½¿ç”¨ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥conn.getInputStream() è·å–åˆ°è¾“å…¥æµï¼Œéœ€è¦å†™ä¸€ä¸ªç±»å°†æµè½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ•°ç»„ï¼å·¥å…·ç±»å¦‚ä¸‹ï¼š

**StreamTool.java**:

```java
public class StreamTool {
    //ä»æµä¸­è¯»å–æ•°æ®
    public static byte[] read(InputStream inStream) throws Exception{
        ByteArrayOutputStream outStream = new ByteArrayOutputStream();
        byte[] buffer = new byte[1024];
        int len = 0;
        while((len = inStream.read(buffer)) != -1)
        {
            outStream.write(buffer,0,len);
        }
        inStream.close();
        return outStream.toByteArray();
    }
}
```

------

### 3.1 HttpURLConnectionå‘é€GETè¯·æ±‚ä»£ç ç¤ºä¾‹

**è¿è¡Œæ•ˆæœå›¾**ï¼š

![åŠ¨ç”»](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/202108080004218.gif)

**æ ¸å¿ƒéƒ¨åˆ†ä»£ç **ï¼š

å¸ƒå±€ï¼š**activity_main.xml**

```xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <TextView
        android:id="@+id/txtMenu"
        android:layout_width="match_parent"
        android:layout_height="48dp"
        android:background="#4EA9E9"
        android:clickable="true"
        android:gravity="center"
        android:text="é•¿æŒ‰æˆ‘ï¼ŒåŠ è½½èœå•"
        android:textSize="20sp" />

    <ImageView
        android:id="@+id/imgPic"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:visibility="gone" />

    <ScrollView
        android:id="@+id/scroll"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:visibility="gone">

        <TextView
            android:id="@+id/txtshow"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content" />
    </ScrollView>

    <WebView
        android:id="@+id/webView"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />

</LinearLayout>
```

è·å–æ•°æ®ç±»ï¼š**GetData.java**:

```java
public class GetData {
    // å®šä¹‰ä¸€ä¸ªè·å–ç½‘ç»œå›¾ç‰‡æ•°æ®çš„æ–¹æ³•:
    public static byte[] getImage(String path) throws Exception {
        URL url = new URL(path);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        // è®¾ç½®è¿æ¥è¶…æ—¶ä¸º5ç§’
        conn.setConnectTimeout(5000);
        // è®¾ç½®è¯·æ±‚ç±»å‹ä¸ºGetç±»å‹
        conn.setRequestMethod("GET");
        // åˆ¤æ–­è¯·æ±‚Urlæ˜¯å¦æˆåŠŸ
        if (conn.getResponseCode() != 200) {
            throw new RuntimeException("è¯·æ±‚urlå¤±è´¥");
        }
        InputStream inStream = conn.getInputStream();
        byte[] bt = StreamTool.read(inStream);
        inStream.close();
        return bt;
    }

    // è·å–ç½‘é¡µçš„htmlæºä»£ç 
    public static String getHtml(String path) throws Exception {
        URL url = new URL(path);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        conn.setConnectTimeout(5000);
        conn.setRequestMethod("GET");
        if (conn.getResponseCode() == 200) {
            InputStream in = conn.getInputStream();
            byte[] data = StreamTool.read(in);
            String html = new String(data, "UTF-8");
            return html;
        }
        return null;
    }
}
```

**MainActivity.java**

[ğŸ”—MainActivity.java](https://github.com/IQQcode/MobileCoding/blob/main/Android-Base/05-Network/BaseNet/02BaseNetWork/app/src/main/java/top/iqqcode/basenet/MainActivity.java)

æœ€ååˆ«å¿˜äº†åŠ ä¸Šè”ç½‘æƒé™ï¼š

```xml
<uses-permission android:name="android.permission.INTERNET" />
```



------

### 3.2 HttpURLConnectionå‘é€POSTè¯·æ±‚ä»£ç ç¤ºä¾‹

æœ‰GETè‡ªç„¶æœ‰POSTï¼Œæˆ‘ä»¬é€šè¿‡openConnectionè·å–åˆ°çš„HttpURLConnectioné»˜è®¤æ˜¯è¿›è¡ŒGetè¯·æ±‚çš„, æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨POSTæäº¤æ•°æ®ï¼Œåº”æå‰è®¾ç½®å¥½ç›¸å…³çš„å‚æ•°:

```java
conn.setRequestMethod("POST");
conn.setDoOutput(true);
conn.setDoInput(true); // è®¾ç½®å…è®¸è¾“å…¥
conn.setUseCaches(false); // POSTæ–¹æ³•ä¸èƒ½ç¼“å­˜ï¼Œè¦æ‰‹åŠ¨è®¾ç½®ä¸ºfalse
```

**è¿è¡Œæ•ˆæœå›¾**:

![img](https://www.runoob.com/wp-content/uploads/2015/09/82507535.jpg)

**æ ¸å¿ƒä»£ç **ï¼š

**PostUtils.java**

```java
public class PostUtils {
    public static String LOGIN_URL = "http://172.16.2.54:8080/HttpTest/ServletForPost";
    public static String LoginByPost(String number,String passwd)
    {
        String msg = "";
        try{
            HttpURLConnection conn = (HttpURLConnection) new URL(LOGIN_URL).openConnection();
            //è®¾ç½®è¯·æ±‚æ–¹å¼,è¯·æ±‚è¶…æ—¶ä¿¡æ¯
            conn.setRequestMethod("POST");
            conn.setReadTimeout(5000);
            conn.setConnectTimeout(5000);
            //è®¾ç½®è¿è¡Œè¾“å…¥,è¾“å‡º:
            conn.setDoOutput(true);
            conn.setDoInput(true);
            //Postæ–¹å¼ä¸èƒ½ç¼“å­˜,éœ€æ‰‹åŠ¨è®¾ç½®ä¸ºfalse
            conn.setUseCaches(false);
            //æˆ‘ä»¬è¯·æ±‚çš„æ•°æ®:
            String data = "passwd="+ URLEncoder.encode(passwd, "UTF-8")+
                    "&number="+ URLEncoder.encode(number, "UTF-8");
            //è¿™é‡Œå¯ä»¥å†™ä¸€äº›è¯·æ±‚å¤´çš„ä¸œä¸œ...
            //è·å–è¾“å‡ºæµ
            OutputStream out = conn.getOutputStream();
            out.write(data.getBytes());
            out.flush();
             if (conn.getResponseCode() == 200) {  
                    // è·å–å“åº”çš„è¾“å…¥æµå¯¹è±¡  
                    InputStream is = conn.getInputStream();  
                    // åˆ›å»ºå­—èŠ‚è¾“å‡ºæµå¯¹è±¡  
                    ByteArrayOutputStream message = new ByteArrayOutputStream();  
                    // å®šä¹‰è¯»å–çš„é•¿åº¦  
                    int len = 0;  
                    // å®šä¹‰ç¼“å†²åŒº  
                    byte buffer[] = new byte[1024];  
                    // æŒ‰ç…§ç¼“å†²åŒºçš„å¤§å°ï¼Œå¾ªç¯è¯»å–  
                    while ((len = is.read(buffer)) != -1) {  
                        // æ ¹æ®è¯»å–çš„é•¿åº¦å†™å…¥åˆ°oså¯¹è±¡ä¸­  
                        message.write(buffer, 0, len);  
                    }  
                    // é‡Šæ”¾èµ„æº  
                    is.close();  
                    message.close();  
                    // è¿”å›å­—ç¬¦ä¸²  
                    msg = new String(message.toByteArray());  
                    return msg;
             }
        }catch(Exception e){e.printStackTrace();}
        return msg;
    }
}
```

<br>

## 4.ä½¿ç”¨HttpURLConnectionå‘é€PUTè¯·æ±‚

```java
public static String LoginByPut(Context mContext, String mobile, String password, int from, String devid,String version_name, int remember_me) {
    String resp = "";
    try {
        HttpURLConnection conn = (HttpURLConnection) new URL(LOGIN_URL).openConnection();
        conn.setRequestMethod("PUT");
        conn.setReadTimeout(5000);
        conn.setConnectTimeout(5000);
        conn.setDoOutput(true);
        conn.setDoInput(true);
        conn.setUseCaches(false);

        String data = "mobile=" + mobile + "&password=" + password + "&from=" + from + "&devid=" + "devid"
                + "&version_name=" + "version_name" + "&remember_me=" + remember_me;
        ;
        // è·å–è¾“å‡ºæµ:
        OutputStreamWriter writer = new OutputStreamWriter(conn.getOutputStream());
        writer.write(data);
        writer.flush();
        writer.close();

        // è·å–ç›¸åº”æµå¯¹è±¡:
        InputStream in = conn.getInputStream();
        BufferedReader reader = new BufferedReader(new InputStreamReader(in));
        StringBuilder response = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null)
            response.append(line);
        SPUtils.put(mContext, "session", conn.getHeaderField("Set-Cookie"));
        // èµ„æºé‡Šæ”¾:
        in.close();
        // è¿”å›å­—ç¬¦ä¸²
        Log.e("HEHE", response.toString());
        return response.toString();
    } catch (Exception e) {
        e.printStackTrace();
    }
    return "";
}
```
