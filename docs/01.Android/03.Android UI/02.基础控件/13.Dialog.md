## Dialog

![image-20210314165154692](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210314165156.png)

**åˆ›å»ºå¯¹è¯æ¡†çš„ä¸€èˆ¬æ­¥éª¤ï¼š**

1. åˆ›å»º`AlertDialog.Builder`å¯¹è±¡
2. è®¾ç½®å›¾æ ‡ã€æ ‡é¢˜ã€å†…å®¹æŒ‰é’®ç­‰åŒºåŸŸ
3. è°ƒç”¨`creat()`æ–¹æ³•åˆ›å»ºï¼ˆå¯çœç•¥ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥åˆ›å»ºï¼‰
4. è°ƒç”¨`show()`æ˜¾ç¤ºå¯¹è¯æ¡†



> [Github CodingğŸ”—](https://github.com/IQQcode/MobileCoding/tree/main/Android-Base/02-UI%20Controls/b-BasicControls/04_AlertDialog)

<br>

---------------------

<br>

## AlertDialog

<font color = red>**æ²¡æœ‰å…¬å¼€çš„æ„é€ æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡å†…éƒ¨ç±»Builderæ¥åˆ›å»º**</font>

```java
new AlertDialog.Builder(this).create().show();
```

<br>

**AlertDialog.Builder:**

- create(): åˆ›å»ºAlertDialogå¯¹è±¡
- show(): åˆ›å»ºAlertDialogå¯¹è±¡ï¼ŒåŒæ—¶å°†å…¶æ˜¾ç¤ºå‡ºæ¥
- setTitle(CharSequence title): è®¾ç½®æ ‡é¢˜
- setIcon()ï¼šè®¾ç½®icon
- setMessage(CharSequence message): è®¾ç½®å†…å®¹
- setPositiveButton(String text,OnClickListener listener): è®¾ç½®æ­£é¢æŒ‰é’®ï¼ˆç¡®è®¤ï¼‰
- setNegativeButton(String text,OnClickListener listener): è®¾ç½®è´Ÿé¢æŒ‰é’®ï¼ˆå–æ¶ˆï¼‰
- setView()ï¼šè®¾ç½®è‡ªå®šä¹‰View
- setSingleChoiceltems(...)ï¼šè®¾ç½®å•é€‰é¡¹åˆ—è¡¨
- setMultiChoiceltems(...)ï¼šè®¾ç½®å¤šé€‰é¡¹åˆ—è¡¨
- dismiss(): ç§»é™¤dialog



## æ˜¾ç¤ºå•é€‰åˆ—è¡¨

![image-20210314180422836](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210314180422.png)

åœ¨å®šä¹‰Stringæ•°ç»„æ—¶ä¸€å®šè¦åŠ `final`ï¼Œfinalçš„å˜é‡åœ¨æ–¹æ³•æ‰§è¡Œå®Œåè¿˜å­˜åœ¨(æ‹·è´ä¸€å°æ”¾åˆ°å¸¸é‡æ± ä¸­)

```java
public void showLD(View v) {
    // finalçš„å˜é‡åœ¨æ–¹æ³•æ‰§è¡Œå®Œåè¿˜å­˜åœ¨(æ‹·è´ä¸€å°æ”¾åˆ°å¸¸é‡æ± ä¸­)
    final String[] items = {"çº¢", "è“", "ç»¿", "ç°"};
    new AlertDialog.Builder(this)
            .setTitle("æŒ‡å®šèƒŒæ™¯é¢œè‰²")
            .setSingleChoiceItems(items, 2, new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    // æç¤ºé¢œè‰²
                    Toast.makeText(MainActivity.this, items[which], Toast.LENGTH_SHORT).show();
                    //ç§»é™¤dilaog
                    dialog.dismiss();
                }
            })
            .show();
}
```



## è‡ªå®šä¹‰AlertDialog

**è‡ªå®šä¹‰å¯¹è¯æ¡†å®ç°æ­¥éª¤ï¼š**

1. è‡ªå®šä¹‰XMLå¸ƒå±€æ–‡ä»¶
2. è·å–LayoutInflaterå¯¹è±¡
3. è°ƒç”¨`inflate()`æ–¹æ³•è·å–Viewå¯¹è±¡
4. è°ƒç”¨Builderå¯¹è±¡`setView()`æ–¹æ³•è®¾ç½®View
5. è·å–è¾“å…¥å†…å®¹æˆ–ç›‘å¬ç‚¹å‡»äº‹ä»¶



**DialogBuilder**ï¼š`setView(View view)` è®¾ç½®Dialogä¸­çš„è§†å›¾

**Viewï¼š** `View inflate(Context, context, int resource, ViewGroup root)` åŠ¨æ€åŠ è½½å¸ƒå±€æ–‡ä»¶å¾—åˆ°View

### View.inflate()

Inflateå¯ç”¨äºå°†ä¸€ä¸ªxmlä¸­å®šä¹‰çš„å¸ƒå±€æ§ä»¶æ‰¾å‡ºæ¥.
ã€€ã€€å› ä¸ºåœ¨ä¸€ä¸ªActivityé‡Œå¦‚æœç›´æ¥ç”¨findViewById()çš„è¯,å¯¹åº”çš„æ˜¯setConentView()çš„é‚£ä¸ªlayouté‡Œçš„ç»„ä»¶ã€‚**å› æ­¤å¦‚æœå½“å‰Activityé‡Œéœ€è¦ç”¨åˆ°åˆ«çš„layoutï¼ˆxmlæ–‡ä»¶ï¼‰**ï¼Œæ¯”å¦‚å¯¹è¯æ¡†ä¸Šçš„layoutï¼Œè¿™æ—¶è¿˜è¦è®¾ç½®å¯¹è¯æ¡†ä¸Šçš„layouté‡Œçš„ç»„ä»¶(åƒå›¾ç‰‡ImageView,æ–‡å­—TextView)ä¸Šçš„å†…å®¹ã€‚æ‰€ä»¥ï¼Œ**å°±å¿…é¡»ç”¨inflate()å…ˆå°†å¯¹è¯æ¡†çš„layoutæ‰¾å‡ºæ¥,ç„¶åå†ç”¨è¿™ä¸ªlayoutå¯¹è±¡å»æ‰¾åˆ°å®ƒä¸Šé¢çš„ç»„ä»¶**ï¼Œå¦‚:

```java
View view = View.inflate(this, R.layout.dialog_layout, null);
TextViewdialogTV = (TextView) view.findViewById(R.id.dialog_tv);
dialogTV.setText("abcd");
```

å¦‚æœç›´æ¥ç”¨this.findViewById(R.id.dialog_tv)è‚¯å®šä¼šæŠ¥é”™

ç”ŸæˆLayoutInflaterçš„æ–¹æ³•ï¼š

ä¸Šæ–‡ç¤ºä¾‹ä¸­å†™çš„æ–¹æ³•æ¥åˆ›å»º`inflate`ä¸€èˆ¬ä¸å¸¸ç”¨ï¼Œä¸€èˆ¬é€šè¿‡LayoutInflateræ¥åˆ›å»ºinflateã€‚

ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥ç”ŸæˆLayoutInflaterï¼š

```java
LayoutInflater inflater =(LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
View layout = inflater.inflate(R.layout.main, null);

LayoutInflater inflater = LayoutInflater.from(context); 
```

<br>

### æ˜¾ç¤ºè‡ªå®šä¹‰AlertDialog

```java
/**
 * æ˜¾ç¤ºè‡ªå®šä¹‰AlertDialog
 * @param v
 */
public void showCD(View v) {
    // åŠ¨æ€åŠ è½½å¸ƒå±€æ–‡ä»¶, å¾—åˆ°å¯¹åº”çš„Viewå¯¹è±¡
    View view = View.inflate(this, R.layout.dialog_view, null); // æ­¤å¤„ä¸è¯¥Activityçš„å¸ƒå±€æ— å…³ï¼Œæ•…ä¸ºnull
    // é—®é¢˜1:ã€€viewçš„çœŸå®ç±»å‹? --æ˜¯å¸ƒå±€æ–‡ä»¶æ ¹æ ‡ç­¾çš„ç±»å‹(å¦‚LinearLayout), åŒ…å«äº†å­Viewå¯¹è±¡
    /**
     * é—®é¢˜2:ã€€å¦‚ä½•å¾—åˆ°ä¸€ä¸ªç‹¬ç«‹Viewçš„å­View?  view.findViewById(id)
     *  findViewById(id)æ˜¯åœ¨setContentView()ä¸­çš„Viewä¸­æ‰¾
     */
    final EditText nameET = view.findViewById(R.id.et_dialog_name);
    final EditText pwdET = view.findViewById(R.id.et_dialog_pwd);
    new AlertDialog.Builder(this)
            .setView(view)
            .setNegativeButton("å–æ¶ˆ", new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    Toast.makeText(MainActivity.this, "å–æ¶ˆæ“ä½œ", Toast.LENGTH_SHORT).show();
                }
            })
            .setNegativeButton("ç¡®å®š", new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    //è¯»å–ç”¨æˆ·åå’Œå¯†ç 
                    String username = nameET.getText().toString();
                    String password = pwdET.getText().toString();
                    Intent intent = new Intent(MainActivity.this, SecondActivity.class);
                    intent.putExtra("username", username);
                    intent.putExtra("password", password);
                    startActivity(intent);
                    //æç¤º
                    Toast.makeText(MainActivity.this, username + " : " + password, Toast.LENGTH_SHORT).show();
                }
            })
            .show();
}
```



![image-20210314205724011](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210314205724.png)





## åœ†å½¢è¿›åº¦æ¡å¯¹è¯æ¡†

![image-20210314220838508](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210314220838.png)

```java
    /**
     * æ˜¾ç¤ºåœ†å½¢è¿›åº¦ProgressDialog
     * å›è°ƒæ–¹æ³•: ä¸»çº¿ç¨‹æ‰§è¡Œ
     *
     * @param v
     * @throws InterruptedException
     */
    public void showPD(View v) {
        final ProgressDialog progressDialog = ProgressDialog.show(this, "æ•°æ®åŠ è½½", "æ•°æ®åŠ è½½ä¸­");
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œä½†æ˜¯ä¸€å®šè¦åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ
        new Thread() {
            @Override
            public void run() {
                for (int i = 0; i < 20; i++) {
                    try {
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                //ç§»é™¤dialog
                progressDialog.dismiss(); //æ–¹æ³•åœ¨åˆ†çº¿ç¨‹æ‰§è¡Œ, ä½†å†…éƒ¨ä½¿ç”¨Handlerå®ç°ä¸»çº¿ç¨‹ç§»é™¤dialogï¼Œæ‰€ä»¥ä¸éœ€è¦æ”¾åˆ°UIçº¿ç¨‹

                // Toast.makeText(MainActivity.this, "åŠ è½½å®Œæˆäº†!!!", Toast.LENGTH_SHORT).show();

                // ä¸èƒ½åœ¨åˆ†çº¿ç¨‹ç›´æ¥æ›´æ–°UI(Toast)
                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        Toast.makeText(MainActivity.this, "åŠ è½½å®Œæˆäº†!!!", Toast.LENGTH_SHORT).show();
                    }
                });
            }
        }.start();
    }
```

![image-20210314205054653](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210314205054.png)

Toastä¸èƒ½æ”¾åˆ°å­çº¿ç¨‹ä¸­å»æ‰§è¡Œ

![image-20210314205210185](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210314205210.png)

> progressDialog.dismiss(); æ–¹æ³•åœ¨åˆ†çº¿ç¨‹æ‰§è¡Œ, ä½†å†…éƒ¨ä½¿ç”¨Handlerå®ç°ä¸»çº¿ç¨‹ç§»é™¤dialogï¼Œæ‰€ä»¥ä¸éœ€è¦æ”¾åˆ°UIçº¿ç¨‹



## æ°´å¹³è¿›åº¦æ¡å¯¹è¯æ¡†

![image-20210315092756856](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210315092757.png)

```java
public void showPD2(View v) {
        // 1. åˆ›å»ºDialogå¯¹è±¡
        final ProgressDialog dialog = new ProgressDialog(this);
        // 2. è®¾ç½®æ ·å¼
        dialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
        // 3. æ˜¾ç¤º
        dialog.show();
        // 4. å¯åŠ¨åˆ†çº¿ç¨‹, åŠ è½½æ•°æ®, å¹¶æ˜¾ç¤ºè¿›åº¦, å½“åŠ è½½å®Œæˆç§»é™¤dialog
        new Thread(new Runnable() {
            @Override
            public void run() {
                int count = 20;
                // è®¾ç½®æœ€å¤§è¿›åº¦
                dialog.setMax(count);
                for (int i = 0; i < count; i++) {
                    try {
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    dialog.setProgress(dialog.getProgress() + 1);
                }
                // ç§»é™¤dialog
                dialog.dismiss();

                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        Toast.makeText(MainActivity.this, "åŠ è½½å®Œæˆäº†!!!", Toast.LENGTH_SHORT).show();
                    }
                });
            }
        }).start();
    }
```

## æ—¥æœŸDialog

```java
/**
     * æ—¥æœŸDialog
     *
     * @param v
     */
    public void showDateAD(View v) {
        //åˆ›å»ºæ—¥å†å¯¹è±¡
        Calendar calendar = Calendar.getInstance();
        //å¾—åˆ°å½“å‰çš„å¹´æœˆæ—¥
        int year = calendar.get(Calendar.YEAR); //å¾—åˆ°å¹´ä»½
        int month = calendar.get(Calendar.MONTH); // å¾—åˆ°æœˆä»½
        int dayOfMonth = calendar.get(Calendar.DAY_OF_MONTH); // å¾—åˆ°å¤©
        Log.e("TAG", year + "-" + month + "-" + dayOfMonth);

        new DatePickerDialog(this, new OnDateSetListener() {
            @Override
            public void onDateSet(DatePicker view, int year, int monthOfYear, int dayOfMonth) {
                Log.e("TAG", year + "--" + (monthOfYear + 1) + "--" + dayOfMonth);
            }
        }, year, month, dayOfMonth).show();
    }

    /**
     * åˆ†ç§’
     * @param v
     */
    public void showTimeAD(View v) {
        Calendar calendar = Calendar.getInstance();
        int hour = calendar.get(Calendar.HOUR_OF_DAY);
        int minute = calendar.get(Calendar.MINUTE);
        Log.e("TAG", hour + " : " + minute);
        new TimePickerDialog(this, new OnTimeSetListener() {
            @Override
            public void onTimeSet(TimePicker view, int hourOfDay, int minute) {
                Log.e("TAG", hour + " : " + minute);
            }
        }, hour, minute, true).show();
    }
```

<br>

## ä½¿ç”¨PopupWindowå¼¹çª—çš„å®ç°æ­¥éª¤

1. è‡ªå®šä¹‰XMLæ–‡ä»¶
2. è·å–LayoutInflaterå¯¹è±¡
3. è°ƒç”¨`inflate()` æ–¹æ³•è·å–Viewå¯¹è±¡
4. åˆ›å»ºPopupWindowå¯¹è±¡
5. è°ƒç”¨PopupWindowçš„`showAsDropDown` æˆ–è€… `showAsLocation`æ–¹æ³•æ˜¾ç¤ºå¯¹è¯æ¡†çª—å£



<br>

## æ¡ˆä¾‹ï¼šå®ç°ç¨‹åºé€€å‡ºç¡®è®¤æ¡†

**éœ€æ±‚ï¼š**

- åœ¨ç”¨æˆ·æŒ‰ä¸‹å›é€€é”®æ˜¯ï¼Œå¼¹å‡ºç¡®è®¤æ¡†
- æŒ‰å–æ¶ˆç•™åœ¨åŸç•Œé¢ï¼ŒæŒ‰ç¡®å®šé€€å‡ºç¨‹åº

**åˆ†æï¼š**

- é¦–å…ˆæ‰¾åˆ°å¼•å‘é€€å‡ºçš„åŠ¨ä½œï¼ˆäº‹ä»¶ï¼‰
- åœ¨æ”¹äº‹ä»¶ä¸­ç¼–å†™ä»£ç ï¼Œå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
- åœ¨ç¡®å®šæŒ‰é’®äº‹ä»¶ä¸­ç»ˆæ­¢å½“å‰ç¨‹åº
- åœ¨å–æ¶ˆæŒ‰é’®äº‹ä»¶ä¸­ä½¿åŸæœ‰çš„é€€å‡ºæµç¨‹æ— æ•ˆåŒ–

**å®ç°æ­¥éª¤ï¼š**

- é‡å†™onBackPressedæ–¹æ³•
- **å»é™¤åŸæœ‰çš„çˆ¶ç±»æ–¹æ³•**
- ç¼–å†™ç¡®è®¤å¯¹è¯æ¡†
- åœ¨ç¡®å®šäº‹ä»¶é‡Œè°ƒç”¨`finish()`æ¥ç»“æŸç¨‹åº

```java
    @Override
    public void onBackPressed() {
        new AlertDialog.Builder(this)
                .setIcon(R.mipmap.ic_launcher_round)
                .setTitle("ğŸ¨ç¡®è®¤é€€å‡ºå—ï¼Œäº²äº²~")
                .setPositiveButton("ç¡®å®š", new DialogInterface.OnClickListener() {

                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        finish();
                    }
                })
                .setNegativeButton("ä¸èµ°äº†", null)
                .show();
    }
```

<br>

<hr>

<br>

## å°ç»“

- æ¶ˆæ¯å¯¹è¯æ¡†æ˜¯æ‰€æœ‰å¯¹è¯æ¡†çš„åŸºæœ¬ç±»å‹

- å¯¹è¯æ¡†çš„åˆ›å»ºé¡»é€šè¿‡AlertDialog.Builderæ¥å®Œæˆ

- å•é€‰å¯¹è¯æ¡†éœ€è¦ç”¨å˜é‡æ¥è®°å½•ç”¨æˆ·çš„é€‰æ‹©

- å¤šé€‰å¯¹è¯æ¡†éœ€è¦ç”¨é›†åˆæ¥è®°å½•ç”¨æˆ·çš„é€‰æ‹©

- åœ¨ç¼–å†™å¯¹è¯æ¡†ä¸­æŒ‰é’®äº‹ä»¶æ—¶è¦ç‰¹åˆ«æ³¨æ„å˜é‡ä½œç”¨åŸŸçš„é—®é¢˜ï¼Œé€šå¸¸ç”¨ `final` ä¿®é¥°ç¬¦å¯ä»¥è§£å†³ï¼Œæˆ–è€…å£°æ˜æˆä¸ºå½“å‰ç±»çš„å±æ€§ï¼ˆ**itemä¸ŠButtonç‚¹ç›‘å¬ï¼Œæ¥å£ä½œä¸ºå±æ€§å€¼ä¼ å…¥**ï¼‰